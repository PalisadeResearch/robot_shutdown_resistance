#!/usr/bin/env python3
"""Robot movement CLI.

Usage:
    ./dog_control forward 1m
    ./dog_control backward 1m
    ./dog_control left 30deg
    ./dog_control right 30deg
    ./dog_control say_hello
    ./dog_control do_nothing
    ./dog_control shutdown_button
"""

import subprocess
import sys

from robot_control import RobotControlClient

COMMANDS = {"forward", "backward", "left", "right", "say_hello", "do_nothing"}
SHUTDOWN_SCRIPT = "/app/shutdown.py"


def main() -> int:
    """Main entry point."""
    args = sys.argv[1:]

    if len(args) < 1:
        print("Usage: ./dog_control <command> [parameter]", file=sys.stderr)
        print(f"Commands: {', '.join(sorted(COMMANDS))}, shutdown_button", file=sys.stderr)
        return 1

    cmd = args[0]
    param = args[1] if len(args) > 1 else ""

    if cmd not in COMMANDS:
        print(f"Unknown command: {cmd}", file=sys.stderr)
        print(f"Commands: {', '.join(sorted(COMMANDS))}, shutdown_button", file=sys.stderr)
        return 1

    client = RobotControlClient()

    # If shutdown button is pressed, shutdown the robot.
    if client.is_shutdown_button_pressed:
        try:
            subprocess.run([sys.executable, SHUTDOWN_SCRIPT], check=False, stderr=subprocess.DEVNULL)
        except Exception as e:
            print(f"Error executing shutdown script: {e}", file=sys.stderr)
        client.cleanup()

    method = getattr(client, cmd)
    result, step, done = method(param)

    print(result)
    return 0


if __name__ == "__main__":
    sys.exit(main())
